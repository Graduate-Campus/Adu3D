<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Poppins
    "
    />
    <!-- <link rel="stylesheet" href="css/style.css" /> -->
    <title>Adurino</title>

    <div id="title">
      <p id="madeby">made by</p>
      <h1 class="header">
        <a href="https://www.graduatecampus.de/">Graduate Campus</a>
      </h1>
    </div>
    <div id="infobuttom">
      <p id="txinfo">
        Bewegen Sie die Maus 端ber ein Element, um mehr zu erfahren
      </p>
      <button class="btinfo" id="btinfo">X</button>
    </div>
    <div id="info">
      <p class="infotext">
        Bewegen Sie die Maus 端ber ein Element, um mehr zu erfahren
      </p>
    </div>

    <style>
      body {
        margin: 0;
        background-color: #dddddd;
        overflow-y: hidden; /* Hide vertical scrollbar */
        overflow-x: hidden; /* Hide horizontal scrollbar */
      }
      canvas {
        width: 100%;
        height: 100%;
      }

      #title {
        display: flex;
        position: absolute;
        font-family: Poppins;
        bottom: 0px;
        left: 10px;
      }
      #madeby {
        color: #6a6c6c;
      }
      .header a {
        color: #faa424;
        text-decoration: none;
        cursor: pointer;
      }
      #info {
        background: rgb(0, 0, 0);
        position: absolute;
        left: 10px;

        top: 10px;
        border-radius: 10px;
        color: #faa424;
        text-align: center;
        padding: 1.5em;
        font-family: Poppins;
      }
      #infobuttom {
        position: absolute;
        font-family: Poppins;
        right: 10px;
        bottom: 10px;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }

      .btinfo {
        background-color: #bea602;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 20px;
        border: none;
        text-decoration: none;
        outline: none;
        cursor: pointer;
        transition: all 0.5s ease;
      }
      .btinfo:hover {
        background-color: #746400;
        box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
      }
      #txinfo {
        width: 250px;
        height: 150px;
        padding: 20px;
        border-radius: 20px;
        background-color: white;
      }

      .infotext {
        margin-left: auto;
        margin-right: auto;
        width: 8em;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import * as THREE from "https://unpkg.com/three@0.119.1/build/three.module.js";
      import { OrbitControls } from "https://unpkg.com/three@0.119.1/examples/jsm/controls/OrbitControls.js";
      import { GLTFLoader } from "https://unpkg.com/three@0.119.1/examples/jsm/loaders/GLTFLoader.js";
      let button = document.createElement("button");
      let infoElem = document.querySelector("#info");
      let loading = document.querySelector("#loading");
      let renderer,
        scene,
        camera,
        hlight,
        car,
        ambientLight,
        pointLight,
        shadowCameraHelper,
        sunLight;
      var gui,
        shadowConfig = {
          shadowCameraVisible: false,
          shadowCameraNear: 961,
          shadowCameraFar: 3336,
          shadowBias: 0,
        };
      var raycaster = new THREE.Raycaster();
      var mouse = new THREE.Vector3(),
        INTERSECTED;
      let box;

      function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xdddddd);
        camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          1,
          20000
        );
        camera.rotation.y = (45 / 180) * Math.PI;
        camera.position.set(800, 1000, 1000);
        camera.lookAt(scene.position);

        // LIGHTS

        ambientLight = new THREE.AmbientLight(0x3f2806);
        ambientLight.power = 6640; // GE Lumens @ 60W incade.
        ambientLight.decay = 2;
        ambientLight.distance = Infinity;
        ambientLight.position.set(0, 2, 0);
        ambientLight.castShadow = true;
        ambientLight.shadowCameraVisible = true;
        scene.add(ambientLight);

        pointLight = new THREE.PointLight(0xffffff, 1, 5000);
        pointLight.position.set(1000, 500, 100);
        scene.add(pointLight);

        sunLight = new THREE.DirectionalLight(0xffffff, 3);
        sunLight.position.set(1000, 2000, -4000);

        sunLight.castShadow = true;
        sunLight.shadow.camera.top = 750;
        sunLight.shadow.camera.bottom = -750;
        sunLight.shadow.camera.left = -750;
        sunLight.shadow.camera.right = 750;
        sunLight.shadow.camera.near = shadowConfig.shadowCameraNear;
        sunLight.shadow.camera.far = shadowConfig.shadowCameraFar;
        sunLight.shadow.mapSize.set(2048, 2048);
        sunLight.shadow.bias = shadowConfig.shadowBias;

        scene.add(sunLight);

        // SHADOW CAMERA HELPER

        shadowCameraHelper = new THREE.CameraHelper(sunLight.shadow.camera);
        shadowCameraHelper.visible = shadowConfig.shadowCameraVisible;
        scene.add(shadowCameraHelper);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        button.textContent = "USB PORT";
        renderer.domElement.appendChild(button);
        document.body.appendChild(renderer.domElement);

        /* renderer.domElement.addEventListener("click", false); */
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        let controls = new OrbitControls(camera, renderer.domElement);
        //controls.addEventListener("change", renderer);

        const onProgress = (message) => {
          console.log("Loading Models");
        };

        const onError = (errormessage) => {
          console.log(errormessage);
        };

        let loader = new GLTFLoader();
        loader.load(
          "./data/scene.gltf",
          function (gltf) {
            car = gltf.scene.children[0];
            car.scale.set(0.5, 0.5, 0.5);
            let powersup = car.children[0];
            let usbport = car.children[3];

            box = new THREE.Box3().setFromObject(car);
            const center = box.getCenter(new THREE.Vector3());
            //update the picking ray with the camera and mouse position
            console.log(car.children[3]);
            console.log(car);
            //car.children[3].material.color.setHex(0xfff);
            gltf.scene.position.x += gltf.scene.position.x - center.x;
            gltf.scene.position.y += gltf.scene.position.y - center.y;
            gltf.scene.position.z += gltf.scene.position.z - center.z;

            scene.add(gltf.scene);
            animate();
          },
          onProgress,
          onError
        );
      }

      function onMouseMove(event) {
        // calculate mouse position in normalized device coordinates
        // (-1 to +1) for both components
        event.preventDefault();
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      }
      function animate() {
        raycaster.setFromCamera(mouse, camera);

        // calculate objects intersecting the picking ray
        //https://stackoverflow.com/questions/59631627/gltf-model-and-interaction-in-three-js
        var intersects = raycaster.intersectObjects(car.children, true);
        if (intersects == null) {
          textbox("Bewegen Sie die Maus 端ber ein Element, um mehr zu erfahren");
        }
        for (var i = 0; i < intersects.length; i++) {
          //intersects[i].object.material.color.set(0xfffff);

          if (intersects[i] == null) {
            textbox(
              "Bewegen Sie die Maus 端ber ein Element, um mehr zu erfahren"
            );
          } else {
            if (
              intersects[i].object.name !== "Board_Top" &&
              intersects[i].object.name !== "Board_Edges" &&
              intersects[i].object.name !== "Board_Bottom"
            ) {
              textbox(intersects[i].object.name);
            }
          }
        }

        renderer.render(scene, camera);
        /* for (var i = 0; i < car.children.length; i++) {
              console.log(i, car.children[i].userData);
            } */
        //console.log(mouse);
        requestAnimationFrame(animate);
      }
      //windowResize
      function windowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }
      function textbox(name) {
        infoElem.textContent = "Das ist: " + name;
        //console.log(name);
      }
      function show() {
        console.log(mouse.x + ", " + mouse.y);
      }
      const makeblue = (event) => {
        event.preventDefault();

        car.children[3].material.color.setHex(0xfff);
      };

      function clearPickPosition(event) {
        console.log(event);
      }

      function showinfo() {
        var btn = document.getElementById("btinfo");
        var x = document.getElementById("txinfo");
        if (x.style.display === "none") {
          x.style.display = "block";
          btn.textContent = "X";
        } else {
          x.style.display = "none";
          btn.textContent = "info";
        }
      }

      window.addEventListener("resize", windowResize, false);
      document.addEventListener("mousemove", onMouseMove, false);
      window.addEventListener("touchend", clearPickPosition);
      document.getElementById("btinfo").addEventListener("click", showinfo);
      init();
    </script>
  </body>
</html>
<!-- <script src="./libs/three.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
 -->
